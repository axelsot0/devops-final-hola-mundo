<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Horario Semanal</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      color: #667eea;
      font-size: 2.5em;
      margin-bottom: 10px;
      animation: fadeInDown 0.8s ease-out;
    }

    .subtitle {
      color: #666;
      font-size: 1.1em;
    }

    /* Formulario de actividades */
    .form-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      color: white;
      animation: fadeIn 1s ease-out;
    }

    .form-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group-days {
      display: flex;
      flex-direction: column;
      grid-column: 1 / -1;
    }

    .days-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .day-checkbox {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .day-checkbox:hover {
      background: white;
      transform: translateY(-2px);
    }

    .day-checkbox input[type="checkbox"] {
      margin-right: 8px;
      cursor: pointer;
      width: 18px;
      height: 18px;
    }

    .day-checkbox label {
      margin: 0;
      cursor: pointer;
      font-size: 0.95em;
    }

    label {
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 0.9em;
    }

    input, select {
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: white;
      color: #667eea;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-danger {
      background: #ff4757;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
    }

    .btn-danger:hover {
      background: #ee5a6f;
    }

    .btn-edit {
      background: #ffa502;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
      margin-right: 5px;
    }

    .btn-edit:hover {
      background: #ff7f00;
    }

    .btn-success {
      background: #2ecc71;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
      margin-right: 10px;
    }

    .btn-success:hover {
      background: #27ae60;
    }

    .btn-info {
      background: #3498db;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
    }

    .btn-info:hover {
      background: #2980b9;
    }

    .import-export-section {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .import-export-section h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.2em;
    }

    .import-export-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    #importFile {
      display: none;
    }

    /* Horario Semanal */
    .schedule-section {
      margin-bottom: 30px;
    }

    .schedule-section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.8em;
    }

    .week-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .day-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s;
      animation: slideUp 0.5s ease-out backwards;
    }

    .day-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .day-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 1.2em;
    }

    .activity-list {
      min-height: 100px;
    }

    .activity-item {
      background: white;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.3s ease-out;
    }

    .activity-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .activity-time {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 5px;
    }

    .activity-duration {
      color: #764ba2;
      font-size: 0.85em;
      font-weight: 600;
    }

    .activity-actions {
      margin-top: 10px;
      display: flex;
      gap: 5px;
    }

    .empty-day {
      text-align: center;
      color: #999;
      padding: 20px;
      font-style: italic;
    }

    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Estilos para días con animación escalonada */
    .day-card:nth-child(1) { animation-delay: 0.1s; }
    .day-card:nth-child(2) { animation-delay: 0.2s; }
    .day-card:nth-child(3) { animation-delay: 0.3s; }
    .day-card:nth-child(4) { animation-delay: 0.4s; }
    .day-card:nth-child(5) { animation-delay: 0.5s; }
    .day-card:nth-child(6) { animation-delay: 0.6s; }
    .day-card:nth-child(7) { animation-delay: 0.7s; }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 2em;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .week-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Mi Horario Semanal</h1>
      <p class="subtitle">Organiza tus actividades diarias y gestiona tu tiempo eficientemente</p>
    </header>

    <!-- Formulario para agregar actividades -->
    <section class="form-section">
      <h2>Agregar Nueva Actividad</h2>
      <form id="activityForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="activityName">Nombre de la Actividad</label>
            <input type="text" id="activityName" placeholder="Ej: Reunión de equipo" required>
          </div>
          <div class="form-group">
            <label for="activityTime">Hora de Inicio</label>
            <input type="time" id="activityTime" required>
          </div>
          <div class="form-group">
            <label for="activityDuration">Duración (minutos)</label>
            <input type="number" id="activityDuration" placeholder="60" min="5" required>
          </div>
          <div class="form-group-days">
            <label>Días de la Semana (selecciona uno o varios)</label>
            <div class="days-container">
              <div class="day-checkbox">
                <input type="checkbox" id="day-lunes" name="activityDays" value="Lunes">
                <label for="day-lunes">Lunes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-martes" name="activityDays" value="Martes">
                <label for="day-martes">Martes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-miercoles" name="activityDays" value="Miércoles">
                <label for="day-miercoles">Miércoles</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-jueves" name="activityDays" value="Jueves">
                <label for="day-jueves">Jueves</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-viernes" name="activityDays" value="Viernes">
                <label for="day-viernes">Viernes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-sabado" name="activityDays" value="Sábado">
                <label for="day-sabado">Sábado</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-domingo" name="activityDays" value="Domingo">
                <label for="day-domingo">Domingo</label>
              </div>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary" id="submitBtn">Agregar Actividad</button>
      </form>
    </section>

    <!-- Sección de Exportar/Importar -->
    <section class="import-export-section">
      <h3>Sincronizar entre Dispositivos</h3>
      <div class="import-export-actions">
        <button class="btn btn-success" onclick="exportActivities()">📥 Exportar Actividades</button>
        <button class="btn btn-info" onclick="document.getElementById('importFile').click()">📤 Importar Actividades</button>
        <input type="file" id="importFile" accept=".json" onchange="importActivities(event)">
        <span style="color: #666; font-size: 0.9em;">Exporta tus actividades como JSON y cárgalas en otro dispositivo</span>
      </div>
    </section>

    <!-- Horario Semanal -->
    <section class="schedule-section">
      <h2>Horario de la Semana</h2>
      <div class="week-grid" id="weekGrid">
        <!-- Los días se generarán dinámicamente con JavaScript -->
      </div>
    </section>
  </div>

  <script>
    // Estructura de datos para almacenar actividades
    let activities = [];
    let editingId = null;

    // Días de la semana
    const daysOfWeek = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];

    // Inicializar la aplicación
    document.addEventListener('DOMContentLoaded', () => {
      loadActivities();
      renderWeek();
      setupEventListeners();
    });

    // Configurar event listeners
    function setupEventListeners() {
      const form = document.getElementById('activityForm');
      form.addEventListener('submit', handleFormSubmit);
    }

    // Manejar envío del formulario
    function handleFormSubmit(e) {
      e.preventDefault();

      const name = document.getElementById('activityName').value.trim();
      const time = document.getElementById('activityTime').value;
      const duration = parseInt(document.getElementById('activityDuration').value);

      // Obtener todos los días seleccionados
      const selectedDays = Array.from(document.querySelectorAll('input[name="activityDays"]:checked'))
        .map(checkbox => checkbox.value);

      // Validar que al menos un día esté seleccionado
      if (selectedDays.length === 0) {
        alert('Por favor selecciona al menos un día de la semana');
        return;
      }

      if (editingId !== null) {
        // Modo edición: actualizar la actividad existente
        const activityIndex = activities.findIndex(a => a.id === editingId);
        activities[activityIndex] = {
          id: editingId,
          name,
          day: selectedDays[0], // En modo edición solo se puede un día
          time,
          duration
        };
        editingId = null;
        document.getElementById('submitBtn').textContent = 'Agregar Actividad';
      } else {
        // Modo crear nueva: crear una actividad por cada día seleccionado
        const baseTimestamp = Date.now();
        selectedDays.forEach((day, index) => {
          const activity = {
            id: baseTimestamp + index, // ID único para cada día
            name,
            day,
            time,
            duration
          };
          activities.push(activity);
        });

        if (selectedDays.length > 1) {
          alert(`Se crearon ${selectedDays.length} actividades (una por cada día seleccionado)`);
        }
      }

      saveActivities();
      renderWeek();
      e.target.reset();
      // Desmarcar todos los checkboxes
      document.querySelectorAll('input[name="activityDays"]').forEach(cb => cb.checked = false);
    }

    // Guardar actividades en localStorage
    function saveActivities() {
      localStorage.setItem('weeklyActivities', JSON.stringify(activities));
    }

    // Cargar actividades desde localStorage
    function loadActivities() {
      const stored = localStorage.getItem('weeklyActivities');
      if (stored) {
        activities = JSON.parse(stored);
      }
    }

    // Renderizar la semana completa
    function renderWeek() {
      const weekGrid = document.getElementById('weekGrid');
      weekGrid.innerHTML = '';

      daysOfWeek.forEach(day => {
        const dayCard = createDayCard(day);
        weekGrid.appendChild(dayCard);
      });
    }

    // Crear tarjeta de día
    function createDayCard(day) {
      const card = document.createElement('div');
      card.className = 'day-card';

      const header = document.createElement('div');
      header.className = 'day-header';
      header.textContent = day;

      const activityList = document.createElement('div');
      activityList.className = 'activity-list';

      // Filtrar y ordenar actividades para este día
      const dayActivities = activities
        .filter(a => a.day === day)
        .sort((a, b) => a.time.localeCompare(b.time));

      if (dayActivities.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'empty-day';
        emptyMessage.textContent = 'Sin actividades';
        activityList.appendChild(emptyMessage);
      } else {
        dayActivities.forEach(activity => {
          const activityItem = createActivityItem(activity);
          activityList.appendChild(activityItem);
        });
      }

      card.appendChild(header);
      card.appendChild(activityList);

      return card;
    }

    // Crear elemento de actividad
    function createActivityItem(activity) {
      const item = document.createElement('div');
      item.className = 'activity-item';

      const name = document.createElement('div');
      name.className = 'activity-name';
      name.textContent = activity.name;

      const time = document.createElement('div');
      time.className = 'activity-time';
      time.textContent = `Hora: ${formatTime(activity.time)}`;

      const duration = document.createElement('div');
      duration.className = 'activity-duration';
      duration.textContent = `Duración: ${activity.duration} min`;

      const actions = document.createElement('div');
      actions.className = 'activity-actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'btn btn-edit';
      editBtn.textContent = 'Editar';
      editBtn.onclick = () => editActivity(activity.id);

      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'btn btn-danger';
      deleteBtn.textContent = 'Eliminar';
      deleteBtn.onclick = () => deleteActivity(activity.id);

      actions.appendChild(editBtn);
      actions.appendChild(deleteBtn);

      item.appendChild(name);
      item.appendChild(time);
      item.appendChild(duration);
      item.appendChild(actions);

      return item;
    }

    // Formatear hora
    function formatTime(time) {
      const [hours, minutes] = time.split(':');
      return `${hours}:${minutes}`;
    }

    // Editar actividad
    function editActivity(id) {
      const activity = activities.find(a => a.id === id);
      if (activity) {
        document.getElementById('activityName').value = activity.name;
        document.getElementById('activityTime').value = activity.time;
        document.getElementById('activityDuration').value = activity.duration;

        // Desmarcar todos los checkboxes primero
        document.querySelectorAll('input[name="activityDays"]').forEach(cb => cb.checked = false);

        // Marcar solo el checkbox del día de esta actividad
        const dayCheckbox = document.querySelector(`input[name="activityDays"][value="${activity.day}"]`);
        if (dayCheckbox) {
          dayCheckbox.checked = true;
        }

        editingId = id;
        document.getElementById('submitBtn').textContent = 'Actualizar Actividad';

        // Scroll al formulario
        document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
      }
    }

    // Eliminar actividad
    function deleteActivity(id) {
      if (confirm('¿Estás seguro de que deseas eliminar esta actividad?')) {
        activities = activities.filter(a => a.id !== id);
        saveActivities();
        renderWeek();

        // Si estábamos editando esta actividad, cancelar edición
        if (editingId === id) {
          editingId = null;
          document.getElementById('activityForm').reset();
          document.querySelectorAll('input[name="activityDays"]').forEach(cb => cb.checked = false);
          document.getElementById('submitBtn').textContent = 'Agregar Actividad';
        }
      }
    }

    // Exportar actividades como JSON
    function exportActivities() {
      if (activities.length === 0) {
        alert('No hay actividades para exportar');
        return;
      }

      const dataStr = JSON.stringify(activities, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const link = document.createElement('a');
      link.href = url;
      link.download = `horario-semanal-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      alert(`Se han exportado ${activities.length} actividades exitosamente`);
    }

    // Importar actividades desde JSON
    function importActivities(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedActivities = JSON.parse(e.target.result);

          // Validar que sea un array
          if (!Array.isArray(importedActivities)) {
            throw new Error('El archivo no contiene un formato válido');
          }

          // Validar estructura de cada actividad
          const isValid = importedActivities.every(activity =>
            activity.id &&
            activity.name &&
            activity.day &&
            activity.time &&
            activity.duration
          );

          if (!isValid) {
            throw new Error('El archivo contiene actividades con formato inválido');
          }

          // Preguntar si sobrescribir o fusionar
          let shouldMerge = false;
          if (activities.length > 0) {
            shouldMerge = confirm(
              `Tienes ${activities.length} actividades guardadas.\n\n` +
              `¿Deseas FUSIONAR las ${importedActivities.length} actividades importadas con las existentes?\n\n` +
              `- OK: Fusionar (mantener ambas)\n` +
              `- Cancelar: Reemplazar (borrar las existentes)`
            );
          }

          if (shouldMerge) {
            // Fusionar: agregar solo actividades nuevas (por ID)
            const existingIds = new Set(activities.map(a => a.id));
            const newActivities = importedActivities.filter(a => !existingIds.has(a.id));
            activities = [...activities, ...newActivities];
            alert(`Se fusionaron ${newActivities.length} actividades nuevas. Total: ${activities.length}`);
          } else {
            // Reemplazar completamente
            activities = importedActivities;
            alert(`Se importaron ${activities.length} actividades exitosamente`);
          }

          saveActivities();
          renderWeek();

        } catch (error) {
          alert(`Error al importar: ${error.message}`);
        }

        // Limpiar el input para permitir re-importar el mismo archivo
        event.target.value = '';
      };

      reader.readAsText(file);
    }
  </script>
</body>
</html>

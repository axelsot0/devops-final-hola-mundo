<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Horario Semanal</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --container-bg: rgba(255, 255, 255, 0.95);
      --text-primary: #333;
      --text-secondary: #666;
      --text-tertiary: #999;
      --card-bg: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      --activity-bg: white;
      --border-color: #667eea;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --shadow-light: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode {
      --bg-gradient-start: #1a1a2e;
      --bg-gradient-end: #16213e;
      --container-bg: rgba(30, 30, 46, 0.95);
      --text-primary: #e4e4e7;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --card-bg: linear-gradient(135deg, #2a2a3e 0%, #1f1f30 100%);
      --activity-bg: #2d2d44;
      --border-color: #8b7dd8;
      --shadow-color: rgba(0, 0, 0, 0.6);
      --shadow-light: rgba(0, 0, 0, 0.3);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: var(--container-bg);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px var(--shadow-color);
      transition: all 0.3s ease;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      position: relative;
    }

    h1 {
      color: var(--border-color);
      font-size: 2.5em;
      margin-bottom: 10px;
      animation: fadeInDown 0.8s ease-out;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 1.1em;
    }

    /* Toggle de modo oscuro */
    .theme-toggle {
      position: absolute;
      top: 0;
      right: 0;
      background: var(--border-color);
      border: none;
      border-radius: 50px;
      padding: 10px 20px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px var(--shadow-light);
    }

    .theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-light);
    }

    .theme-icon {
      font-size: 1.2em;
    }

    /* Formulario de actividades */
    .form-section {
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      color: white;
      animation: fadeIn 1s ease-out;
    }

    .form-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    label {
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 0.9em;
    }

    input, select {
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s;
      color: #333;
    }

    input:focus, select:focus {
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    /* Selector de d√≠as m√∫ltiple */
    .days-selector {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      padding: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .day-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      transition: all 0.2s;
      background: white;
    }

    .day-checkbox:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    .day-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--border-color);
    }

    .day-checkbox label {
      margin: 0;
      cursor: pointer;
      color: #333;
      font-weight: 500;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: white;
      color: #667eea;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn-danger {
      background: #ff4757;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
    }

    .btn-danger:hover {
      background: #ee5a6f;
    }

    .btn-edit {
      background: #ffa502;
      color: white;
      padding: 8px 15px;
      font-size: 0.9em;
      margin-right: 5px;
    }

    .btn-edit:hover {
      background: #ff7f00;
    }

    /* Horario Semanal */
    .schedule-section {
      margin-bottom: 30px;
    }

    .schedule-section h2 {
      color: var(--border-color);
      margin-bottom: 20px;
      font-size: 1.8em;
    }

    .week-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .day-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px var(--shadow-light);
      transition: transform 0.3s;
      animation: slideUp 0.5s ease-out backwards;
    }

    .day-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px var(--shadow-light);
    }

    .day-header {
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 1.2em;
    }

    .activity-list {
      min-height: 100px;
    }

    .activity-item {
      background: var(--activity-bg);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid var(--border-color);
      box-shadow: 0 2px 5px var(--shadow-light);
      animation: fadeIn 0.3s ease-out;
      transition: all 0.3s;
    }

    .activity-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 5px;
    }

    .activity-time {
      color: var(--text-secondary);
      font-size: 0.9em;
      margin-bottom: 5px;
    }

    .activity-duration {
      color: var(--border-color);
      font-size: 0.85em;
      font-weight: 600;
    }

    .activity-actions {
      margin-top: 10px;
      display: flex;
      gap: 5px;
    }

    .empty-day {
      text-align: center;
      color: var(--text-tertiary);
      padding: 20px;
      font-style: italic;
    }

    /* Animaciones */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Estilos para d√≠as con animaci√≥n escalonada */
    .day-card:nth-child(1) { animation-delay: 0.1s; }
    .day-card:nth-child(2) { animation-delay: 0.2s; }
    .day-card:nth-child(3) { animation-delay: 0.3s; }
    .day-card:nth-child(4) { animation-delay: 0.4s; }
    .day-card:nth-child(5) { animation-delay: 0.5s; }
    .day-card:nth-child(6) { animation-delay: 0.6s; }
    .day-card:nth-child(7) { animation-delay: 0.7s; }

    /* Modal personalizado */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: var(--container-bg);
      border-radius: 15px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.3s ease-out;
    }

    .modal-header {
      font-size: 1.5em;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 15px;
    }

    .modal-body {
      color: var(--text-secondary);
      margin-bottom: 25px;
      line-height: 1.6;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .modal-actions .btn {
      flex: 1;
      min-width: 120px;
    }

    .btn-secondary {
      background: var(--text-tertiary);
      color: white;
    }

    .btn-secondary:hover {
      background: var(--text-secondary);
    }

    .btn-warning {
      background: #ffa502;
      color: white;
    }

    .btn-warning:hover {
      background: #ff7f00;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 2em;
      }

      .theme-toggle {
        position: relative;
        margin-bottom: 20px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .week-grid {
        grid-template-columns: 1fr;
      }

      .days-selector {
        grid-template-columns: repeat(2, 1fr);
      }

      .modal-actions {
        flex-direction: column;
      }

      .modal-actions .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <button class="theme-toggle" id="themeToggle">
        <span class="theme-icon">üåô</span>
        <span>Modo Oscuro</span>
      </button>
      <h1>¬°Hola Mundo desde GitHub Pages!</h1>
      <p class="subtitle">Organiza tus actividades diarias y gestiona tu tiempo eficientemente</p>
    </header>

    <!-- Formulario para agregar actividades -->
    <section class="form-section">
      <h2>Agregar Nueva Actividad</h2>
      <form id="activityForm">
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="activityName">Nombre de la Actividad</label>
            <input type="text" id="activityName" placeholder="Ej: Reuni√≥n de equipo" required>
          </div>
          
          <div class="form-group full-width">
            <label>D√≠as de la Semana (selecciona uno o varios)</label>
            <div class="days-selector" id="daysSelector">
              <div class="day-checkbox">
                <input type="checkbox" id="day-lunes" value="Lunes">
                <label for="day-lunes">Lunes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-martes" value="Martes">
                <label for="day-martes">Martes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-miercoles" value="Mi√©rcoles">
                <label for="day-miercoles">Mi√©rcoles</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-jueves" value="Jueves">
                <label for="day-jueves">Jueves</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-viernes" value="Viernes">
                <label for="day-viernes">Viernes</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-sabado" value="S√°bado">
                <label for="day-sabado">S√°bado</label>
              </div>
              <div class="day-checkbox">
                <input type="checkbox" id="day-domingo" value="Domingo">
                <label for="day-domingo">Domingo</label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="activityTime">Hora de Inicio</label>
            <input type="time" id="activityTime" required>
          </div>
          <div class="form-group">
            <label for="activityDuration">Duraci√≥n (minutos)</label>
            <input type="number" id="activityDuration" placeholder="60" min="5" required>
          </div>
        </div>
        <button type="submit" class="btn btn-primary" id="submitBtn">Agregar Actividad</button>
      </form>
    </section>

    <!-- Horario Semanal -->
    <section class="schedule-section">
      <h2>Horario de la Semana</h2>
      <div class="week-grid" id="weekGrid">
        <!-- Los d√≠as se generar√°n din√°micamente con JavaScript -->
      </div>
    </section>
  </div>

  <!-- Modal de confirmaci√≥n -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header" id="modalHeader">Confirmar acci√≥n</div>
      <div class="modal-body" id="modalBody">¬øEst√°s seguro?</div>
      <div class="modal-actions" id="modalActions">
        <!-- Los botones se generar√°n din√°micamente -->
      </div>
    </div>
  </div>

  <script>
    // Estructura de datos para almacenar actividades
    let activities = [];
    let editingId = null;
    let serverAvailable = true; // Rastrear si el servidor est√° disponible

    // D√≠as de la semana
    const daysOfWeek = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];

    // URL de la API (se puede configurar seg√∫n el entorno)
    const API_URL = window.location.origin + '/api';

    // Inicializar la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', async () => {
      await loadActivities();
      loadThemePreference();
      renderWeek();
      setupEventListeners();
    });

    // Configurar event listeners
    function setupEventListeners() {
      const form = document.getElementById('activityForm');
      form.addEventListener('submit', handleFormSubmit);

      const themeToggle = document.getElementById('themeToggle');
      themeToggle.addEventListener('click', toggleTheme);
    }

    // Toggle de modo oscuro
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      
      const themeToggle = document.getElementById('themeToggle');
      const icon = themeToggle.querySelector('.theme-icon');
      const text = themeToggle.querySelector('span:last-child');
      
      if (isDark) {
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Modo Claro';
      } else {
        icon.textContent = 'üåô';
        text.textContent = 'Modo Oscuro';
      }

      // Guardar preferencia
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }

    // Cargar preferencia de tema
    function loadThemePreference() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-mode');
        const themeToggle = document.getElementById('themeToggle');
        const icon = themeToggle.querySelector('.theme-icon');
        const text = themeToggle.querySelector('span:last-child');
        icon.textContent = '‚òÄÔ∏è';
        text.textContent = 'Modo Claro';
      }
    }

    // Obtener d√≠as seleccionados
    function getSelectedDays() {
      const checkboxes = document.querySelectorAll('#daysSelector input[type="checkbox"]:checked');
      return Array.from(checkboxes).map(cb => cb.value);
    }

    // Establecer d√≠as seleccionados
    function setSelectedDays(days) {
      // Primero desmarcar todos
      document.querySelectorAll('#daysSelector input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
      });
      
      // Marcar los d√≠as proporcionados
      days.forEach(day => {
        const checkbox = document.querySelector(`#daysSelector input[value="${day}"]`);
        if (checkbox) {
          checkbox.checked = true;
        }
      });
    }

    // Manejar env√≠o del formulario
    async function handleFormSubmit(e) {
      e.preventDefault();

      const name = document.getElementById('activityName').value.trim();
      const selectedDays = getSelectedDays();
      const time = document.getElementById('activityTime').value;
      const duration = parseInt(document.getElementById('activityDuration').value);

      if (selectedDays.length === 0) {
        alert('Por favor, selecciona al menos un d√≠a de la semana');
        return;
      }

      if (editingId !== null) {
        // Modo edici√≥n - eliminar la actividad antigua
        await deleteActivityById(editingId, false);
        editingId = null;
        document.getElementById('submitBtn').textContent = 'Agregar Actividad';
      }

      // Crear actividades para cada d√≠a seleccionado
      const newActivities = selectedDays.map(day => ({
        id: Date.now() + Math.random().toString(), // ID √∫nico para cada actividad
        name,
        day,
        time,
        duration
      }));

      await saveActivities(newActivities);
      await loadActivities();
      renderWeek();
      e.target.reset();

      // Desmarcar todos los checkboxes
      setSelectedDays([]);
    }

    // Guardar actividades en el servidor
    async function saveActivities(newActivities) {
      try {
        const response = await fetch(`${API_URL}/activities`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(newActivities)
        });

        if (!response.ok) {
          throw new Error('Error al guardar actividades');
        }

        return await response.json();
      } catch (error) {
        console.error('Error saving activities:', error);
        alert('Error al guardar las actividades. Por favor, intenta de nuevo.');
      }
    }

    // Cargar actividades desde el servidor
    async function loadActivities() {
      try {
        const response = await fetch(`${API_URL}/activities`);

        if (!response.ok) {
          throw new Error('Error al cargar actividades');
        }

        activities = await response.json();
        serverAvailable = true;
      } catch (error) {
        console.error('Error loading activities:', error);
        serverAvailable = false;

        // Si hay error, cargar desde localStorage como fallback (sin mostrar alerta)
        const stored = localStorage.getItem('weeklyActivities');
        if (stored) {
          activities = JSON.parse(stored);
        } else {
          activities = [];
        }
      }
    }

    // Mostrar modal personalizado
    function showModal(title, message, buttons) {
      return new Promise((resolve) => {
        const modal = document.getElementById('confirmModal');
        const modalHeader = document.getElementById('modalHeader');
        const modalBody = document.getElementById('modalBody');
        const modalActions = document.getElementById('modalActions');

        modalHeader.textContent = title;
        modalBody.textContent = message;
        modalActions.innerHTML = '';

        buttons.forEach(button => {
          const btn = document.createElement('button');
          btn.className = `btn ${button.className}`;
          btn.textContent = button.text;
          btn.onclick = () => {
            modal.classList.remove('active');
            resolve(button.value);
          };
          modalActions.appendChild(btn);
        });

        modal.classList.add('active');

        // Cerrar al hacer clic fuera del modal
        modal.onclick = (e) => {
          if (e.target === modal) {
            modal.classList.remove('active');
            resolve(null);
          }
        };
      });
    }

    // Renderizar la semana completa
    function renderWeek() {
      const weekGrid = document.getElementById('weekGrid');
      weekGrid.innerHTML = '';

      daysOfWeek.forEach(day => {
        const dayCard = createDayCard(day);
        weekGrid.appendChild(dayCard);
      });
    }

    // Crear tarjeta de d√≠a
    function createDayCard(day) {
      const card = document.createElement('div');
      card.className = 'day-card';

      const header = document.createElement('div');
      header.className = 'day-header';
      header.textContent = day;

      const activityList = document.createElement('div');
      activityList.className = 'activity-list';

      // Filtrar y ordenar actividades para este d√≠a (de m√°s temprano a m√°s tarde)
      const dayActivities = activities
        .filter(a => a.day === day)
        .sort((a, b) => {
          // Convertir tiempo a minutos para comparaci√≥n precisa
          const timeA = timeToMinutes(a.time);
          const timeB = timeToMinutes(b.time);
          return timeA - timeB;
        });

      if (dayActivities.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'empty-day';
        emptyMessage.textContent = 'Sin actividades';
        activityList.appendChild(emptyMessage);
      } else {
        dayActivities.forEach(activity => {
          const activityItem = createActivityItem(activity);
          activityList.appendChild(activityItem);
        });
      }

      card.appendChild(header);
      card.appendChild(activityList);

      return card;
    }

    // Convertir tiempo a minutos para ordenamiento
    function timeToMinutes(time) {
      const [hours, minutes] = time.split(':').map(Number);
      return hours * 60 + minutes;
    }

    // Crear elemento de actividad
    function createActivityItem(activity) {
      const item = document.createElement('div');
      item.className = 'activity-item';

      const name = document.createElement('div');
      name.className = 'activity-name';
      name.textContent = activity.name;

      const time = document.createElement('div');
      time.className = 'activity-time';
      time.textContent = `‚è∞ ${formatTime(activity.time)}`;

      const duration = document.createElement('div');
      duration.className = 'activity-duration';
      duration.textContent = `‚è±Ô∏è Duraci√≥n: ${activity.duration} min`;

      const actions = document.createElement('div');
      actions.className = 'activity-actions';

      const editBtn = document.createElement('button');
      editBtn.className = 'btn btn-edit';
      editBtn.textContent = 'Editar';
      editBtn.onclick = () => editActivity(activity.id);

      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'btn btn-danger';
      deleteBtn.textContent = 'Eliminar';
      deleteBtn.onclick = () => deleteActivity(activity.id);

      actions.appendChild(editBtn);
      actions.appendChild(deleteBtn);

      item.appendChild(name);
      item.appendChild(time);
      item.appendChild(duration);
      item.appendChild(actions);

      return item;
    }

    // Formatear hora a formato 12 horas
    function formatTime(time) {
      const [hours, minutes] = time.split(':').map(Number);
      const period = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      return `${displayHours}:${minutes.toString().padStart(2, '0')} ${period}`;
    }

    // Editar actividad
    function editActivity(id) {
      const activity = activities.find(a => a.id === id);
      if (activity) {
        document.getElementById('activityName').value = activity.name;
        document.getElementById('activityTime').value = activity.time;
        document.getElementById('activityDuration').value = activity.duration;

        // Buscar todas las actividades con el mismo nombre, hora y duraci√≥n
        const relatedActivities = activities.filter(a => 
          a.name === activity.name && 
          a.time === activity.time && 
          a.duration === activity.duration
        );

        // Seleccionar los d√≠as correspondientes
        const days = relatedActivities.map(a => a.day);
        setSelectedDays(days);

        editingId = id;
        document.getElementById('submitBtn').textContent = 'Actualizar Actividad';

        // Scroll al formulario
        document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
      }
    }

    // Eliminar actividad por ID (funci√≥n auxiliar)
    async function deleteActivityById(id) {
      try {
        const response = await fetch(`${API_URL}/activities/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error('Error al eliminar actividad');
        }

        return true;
      } catch (error) {
        console.error('Error deleting activity:', error);
        // Solo mostrar error si el servidor estaba disponible antes
        if (serverAvailable) {
          alert('Error al eliminar la actividad. Por favor, intenta de nuevo.');
        }
        return false;
      }
    }

    // Eliminar m√∫ltiples actividades
    async function deleteMultipleActivities(ids) {
      try {
        const response = await fetch(`${API_URL}/activities/delete-multiple`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ ids })
        });

        if (!response.ok) {
          throw new Error('Error al eliminar actividades');
        }

        return true;
      } catch (error) {
        console.error('Error deleting multiple activities:', error);
        // Solo mostrar error si el servidor estaba disponible antes
        if (serverAvailable) {
          alert('Error al eliminar las actividades. Por favor, intenta de nuevo.');
        }
        return false;
      }
    }

    // Eliminar actividad
    async function deleteActivity(id) {
      const activity = activities.find(a => a.id === id);

      if (!activity) return;

      // Buscar todas las actividades relacionadas (mismo nombre, hora y duraci√≥n)
      const relatedActivities = activities.filter(a =>
        a.name === activity.name &&
        a.time === activity.time &&
        a.duration === activity.duration
      );

      let userChoice;
      let success = false;

      if (relatedActivities.length > 1) {
        // Actividad repetida - mostrar modal con 3 opciones
        const days = relatedActivities.map(a => a.day).join(', ');
        userChoice = await showModal(
          'Eliminar Actividad',
          `"${activity.name}" se repite en ${relatedActivities.length} d√≠as (${days}).\n\n¬øQu√© deseas hacer?`,
          [
            { text: 'Cancelar', className: 'btn-secondary', value: 'cancel' },
            { text: `Borrar solo ${activity.day}`, className: 'btn-warning', value: 'one' },
            { text: 'Borrar de todos los d√≠as', className: 'btn-danger', value: 'all' }
          ]
        );

        if (userChoice === 'all') {
          // Eliminar de todos los d√≠as
          const idsToDelete = relatedActivities.map(a => a.id);
          success = await deleteMultipleActivities(idsToDelete);
        } else if (userChoice === 'one') {
          // Eliminar solo de este d√≠a
          success = await deleteActivityById(id);
        }
        // Si userChoice === 'cancel' o null, no hacer nada
      } else {
        // Solo existe en un d√≠a - mostrar confirmaci√≥n simple
        userChoice = await showModal(
          'Eliminar Actividad',
          `¬øEst√°s seguro de que deseas eliminar "${activity.name}"?`,
          [
            { text: 'Cancelar', className: 'btn-secondary', value: 'cancel' },
            { text: 'Eliminar', className: 'btn-danger', value: 'delete' }
          ]
        );

        if (userChoice === 'delete') {
          success = await deleteActivityById(id);
        }
      }

      // Si se elimin√≥ exitosamente, actualizar la vista
      if (success) {
        await loadActivities();
        renderWeek();

        // Si est√°bamos editando esta actividad, cancelar edici√≥n
        if (editingId === id) {
          editingId = null;
          document.getElementById('activityForm').reset();
          setSelectedDays([]);
          document.getElementById('submitBtn').textContent = 'Agregar Actividad';
        }
      }
    }
  </script>
</body>
</html>
